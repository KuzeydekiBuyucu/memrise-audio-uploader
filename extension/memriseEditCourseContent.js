define([    'jquery'], function (    /** JQueryStatic */ $) {    /** class */    var WordRow = function (element) {        this.$element = $(element);        this.word = this.$element            .find('td.cell.text.column[data-key="1"]')            .find('div.text')            .text();        this.$audioCell = this.$element.find('td.cell.audio.column');        this.audioCellId = this.$audioCell.attr('data-key');        var $audiosMenu = this.$audioCell.find('div.dropdown-menu.audios');        this.hasSound = $audiosMenu.length && $audiosMenu.children().length > 0;        this.thingId = this.$element.attr('data-thing-id');    };    /** @memberOf WordRow */    WordRow.prototype.replaceAudioCell = function(/** htmlString */ html) {        this.$audioCell.replaceWith($(html));    };    /** @memberOf WordRow */    WordRow.prototype.audioCellAddErrorMsg = function() {        var errorSpan = '<span style="color: red" class="mau-upload-error"> Error</span>';        this.$audioCell.append(errorSpan);        setTimeout(function () {            this.$element.find('span.mau-upload-error').remove();        }.bind(this), 1500)    };    /** @memberOf WordRow */    WordRow.prototype.audioCellAddUploadingMsg = function() {        var msgSpan = '<span class="mau-uploading-msg"> Uploading...</span>';        this.$audioCell.append(msgSpan);        return function () {            this.$element.find('span.mau-uploading-msg').remove();        }.bind(this);    };    /** @class */    var MemriseCourse = function () {        /** @type {WordRow[]} */        this.rows = undefined;        this.wordsLanguage = undefined;        this.middlewareToken = undefined;        this._grabMemriseToken();    };    /** @memberOf MemriseCourse */    MemriseCourse.prototype.initialize = function () {        var $table = $('table.level-things.table');        var $rows = $table.find('tr.thing');        this.wordsLanguage = $table.find('th.column[data-key="1"]').find('span.txt').text();        this.rows = [];        $rows.each(function (index, $row) {            this.rows.push(new WordRow($row));        }.bind(this));        return this.rows;    };    /** @memberOf MemriseCourse */    MemriseCourse.prototype.uploadSound = function(/** WordRow */ row, /** Blob */ sound)    {        var data = new FormData();        data.append('thing_id', row.thingId);        data.append('cell_id', row.audioCellId);        data.append('cell_type', 'column');        data.append('csrfmiddlewaretoken', this.middlewareToken);        data.append('f', sound, 'file.mp3');        return $.ajax({            type: 'POST',            processData: false,            contentType: false,            url: 'https://www.memrise.com/ajax/thing/cell/upload_file/',            headers: {'Upgrade-Insecure-Requests': '1'},            data: data        });    };    MemriseCourse.prototype._grabMemriseToken = function () {        document.addEventListener('mau-set-memrise-token', function (event) {            this.middlewareToken = event.detail;        }.bind(this));        var th = document.getElementsByTagName('body')[0];        var s = document.createElement('script');        s.setAttribute('type', 'text/javascript');        s.setAttribute('src', chrome.extension.getURL('pageInjectedScript.js'));        th.appendChild(s);    };    return new MemriseCourse();});